<head>
  <meta charset="utf-8" />
</head>
<body id="body">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/107/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.js"></script>
  <script src="./fog.js"></script>
  <script src="_common.js"></script>
  <script>
    let lastConfig;
    let initialized = false;
    // debug: aff_render();
    function aff_render(config) {
      // debug: config = JSON.parse();

      const {
        baseColor,
        blur,
        palette: [highlightColor, midtoneColor, lowlightColor],
        zoom
      } = config;

      VANTA.FOG({
        el: "#body",
        highlightColor,
        midtoneColor,
        lowlightColor,
        baseColor,
        blurFactor: parseFloat(`0.${config.blur}`),
        zoom
      })

      initialized = true;
    }

    function aff_download() {
      var link = document.createElement("a");
      var image = document
        .querySelector(".vanta-canvas")
        .toDataURL("image/png")
        .replace("image/png", "image/octet-stream");
      postDownloadImage({ image });
    }
  </script>
</body>
